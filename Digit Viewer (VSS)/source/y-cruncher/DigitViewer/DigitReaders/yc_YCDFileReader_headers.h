/* yc_YCDFileReader_headers.h - .ycd Reader Object
 * 
 * Author           : Alexander J. Yee
 * Date Created     : 07/13/2013
 * Last Modified    : 07/28/2013
 * 
 * 
 *  This class represents a file handle to a single .ycd file. When constructed,
 *  it parses and holds all the metadata in it.
 * 
 *  An instance of this class allows the user to:
 *      -   Read raw 64-bit words from the file.
 *      -   Read digits from the file.
 * 
 */

#pragma once
#ifndef _yc_YCDFileReader_headers_H
#define _yc_YCDFileReader_headers_H
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
//  Dependencies
#include <string>
#include "../DigitViewer_globals.h"
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
namespace DigitViewer{
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
class YCDFileReader{
public:
    //  Movable
    YCDFileReader();
    YCDFileReader(YCDFileReader &&);
    void operator=(YCDFileReader &&);
    ~YCDFileReader();
private:
    //  But not copyable
    YCDFileReader(const YCDFileReader &);
    void operator=(const YCDFileReader &);

public:
    YCDFileReader(std::wstring path);

    void print() const;
    void read_words(ym_fL pos,ym_u64 *T,ym_pL L);
    void read_chars(
        ym_uL pos,char *str,ym_pL digits,
        ym_u64 *buffer,ym_pL buffer_L,
        void (*fp_convert)(char*,const ym_u64*,ym_pL)
    );

private:
    std::wstring path;
    ym_file file;

    std::string file_version;
    int radix;
    std::string first_digits;
    ym_uL total_digits;
    ym_fL digits_per_file;
    ym_uL file_id;

    ym_pL digits_per_word;
    ym_fL words_in_this_file;
    ym_fL data_offset;              //  Offset where the actual data blocks begin.

    friend class YCDReader;
};
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
}
#endif
